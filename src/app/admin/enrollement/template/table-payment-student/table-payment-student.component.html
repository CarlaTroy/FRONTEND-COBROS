<p-toast></p-toast>
<div class="col-12 md:col-12" *ngIf="!modelPayments && !modelStatusPays">
    <p-progressBar mode="indeterminate" ></p-progressBar>
</div>
<div class="col-12 md:col-12" *ngIf="modelPayments  && modelStatusPays">
    <div class="grid">
        <div class="col-6">
            <div class="grid">
                <div class="col">
                    <b>Estudiante</b>
                    <br>
                    <span>{{modelEnrollement.student.name+" "+modelEnrollement.student.last_name }} </span></div>
                <div class="col">
                    <b>Cedula</b>
                    <br>
                    <span>{{modelEnrollement.student.identification}} </span>
                </div>
                <div class="col">
                    <b> Dirección</b>
                    <br>
                    <span>{{modelEnrollement.student.address}} </span></div>
            </div>
        </div>
        <div class="col-6">
            <div class="grid">
                <div class="col">
                    <b>Curso</b>
                    <br>
                    <span>{{modelEnrollement.cohorte.name}} </span>
                </div>
                <div class="col">
                    <b>Fecha Inicio</b>
                    <br>
                    <span>{{modelEnrollement.cohorte.date_init}} </span>
                </div>
                <div class="col">
                    <b>Fecha Fin</b>
                    <br>
                    <span>{{modelEnrollement.cohorte.date_end}} </span>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="grid">
                <div class="col">
                    <b>Valor del Curso Efectivo</b>
                    <br>
                    <span>{{modelEnrollement.cohorte.cost_effective}} </span>
                </div>
                <div class="col">
                    <b>Valor del Curso Credito</b>
                    <br>
                    <span>{{modelEnrollement.cohorte.cost_credit}} </span>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="grid">
                <div class="col">
                    <b>Curso</b>
                    <br>
                    <span>{{modelEnrollement.cohorte.course.name}} </span>
                </div>
                <div class="col">
                    <b>Descripción</b>
                    <br>
                    <span>{{modelEnrollement.cohorte.course.description}} </span>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="grid">
                <div class="col">
                    <b>Valor Real a pagar</b>
                    <br>
                    <span>{{coustReal}} </span>
                </div>
                <div class="col">
                    <b>Descuento</b>
                    <br>
                    <span>{{modelEnrollement.discount}}%</span>
                </div>
                <div class="col">
                    <b># Cuotas</b>
                    <br>
                    <span>{{modelEnrollement.cuotas}}</span>
                </div>
            </div>
        </div>
    </div>
    <p-table [value]="modelPayments"  dataKey="id" editMode="row" *ngIf="modelPayments">
        <ng-template pTemplate="header">
            <tr>
                <th>#</th>
                <th>Fecha Pago</th>
                <th>Fecha Limite</th>
                <th>Monto</th>
                <th>Estado Pago</th>
                <th>Saldo</th>
                <th></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-payment let-rowIndex="rowIndex"  let-editing="editing" let-ri="rowIndex">
            <tr [pEditableRow]="payment">
                <td>{{rowIndex+1}}</td>
                <td>
                    <!-- {{payment.date_pay}} -->
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <input pInputText type="date" [(ngModel)]="payment.date_pay">
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{payment.date_pay}}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>{{payment.date_limit}}</td>
                <td>{{payment.amount}}</td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-dropdown
                                [options]="modelStatusPays"
                                [(ngModel)]="payment.status_pay"
                                optionLabel="name"
                                [style]="{'width':'100%'}"></p-dropdown>
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{payment.status_pay.name|json}}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                     {{coustReal-(payment.amount*(rowIndex))}}
                </td>
                <td>
                    <div class="flex align-items-center justify-content-center gap-2">
                        <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" (click)="onRowEditInit(payment)" class="p-button-rounded p-button-text"></button>
                        <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check" (click)="onRowEditSave(payment)" class="p-button-rounded p-button-text p-button-success mr-2"></button>
                        <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times" (click)="onRowEditCancel(payment, ri)" class="p-button-rounded p-button-text p-button-danger"></button>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
    <div class="grid flex flex-row-reverse mt-4">
        <div class="grid">
            <div class="col">
                <button type="button"
                pButton icon="pi pi-times"
                label="Cerrar" class="p-button-raised p-button-danger"
                (click)="closeModal()"></button>
            </div>
        </div>
    </div>
</div>
